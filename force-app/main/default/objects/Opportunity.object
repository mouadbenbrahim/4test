<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionOverrides>
        <actionName>AddInfluence</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>AddInfluence</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>AddInfluence</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <compactLayoutAssignment>SYSTEM</compactLayoutAssignment>
    <enableFeeds>true</enableFeeds>
    <enableHistory>false</enableHistory>
    <externalSharingModel>Private</externalSharingModel>
    <fields>
        <fullName>AccountId</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>Amount</fullName>
        <trackFeedHistory>true</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>CampaignId</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>CloseDate</fullName>
        <trackFeedHistory>true</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>ContractId</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>CurrentGenerators__c</fullName>
        <externalId>false</externalId>
        <label>Current Generator(s)</label>
        <length>100</length>
        <required>false</required>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>DeliveryInstallationStatus__c</fullName>
        <externalId>false</externalId>
        <label>Delivery/Installation Status</label>
        <required>false</required>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Picklist</type>
        <valueSet>
            <valueSetDefinition>
                <sorted>false</sorted>
                <value>
                    <fullName>In progress</fullName>
                    <default>false</default>
                    <label>In progress</label>
                </value>
                <value>
                    <fullName>Yet to begin</fullName>
                    <default>false</default>
                    <label>Yet to begin</label>
                </value>
                <value>
                    <fullName>Completed</fullName>
                    <default>false</default>
                    <label>Completed</label>
                </value>
            </valueSetDefinition>
        </valueSet>
    </fields>
    <fields>
        <fullName>Description</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>ExpectedRevenue</fullName>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>IqScore</fullName>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>IsPrivate</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>LeadSource</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Picklist</type>
    </fields>
    <fields>
        <fullName>MainCompetitors__c</fullName>
        <externalId>false</externalId>
        <label>Main Competitor(s)</label>
        <length>100</length>
        <required>false</required>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Name</fullName>
        <trackFeedHistory>true</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>NextStep</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>OrderNumber__c</fullName>
        <externalId>false</externalId>
        <label>Order Number</label>
        <length>8</length>
        <required>false</required>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>OwnerId</fullName>
        <trackFeedHistory>true</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>PartnerAccountId</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>Pricebook2Id</fullName>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>Probability</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>StageName</fullName>
        <trackFeedHistory>true</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Picklist</type>
    </fields>
    <fields>
        <fullName>TotalOpportunityQuantity</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
    </fields>
    <fields>
        <fullName>TrackingNumber__c</fullName>
        <externalId>false</externalId>
        <label>Tracking Number</label>
        <length>12</length>
        <required>false</required>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Type</fullName>
        <trackFeedHistory>false</trackFeedHistory>
        <trackTrending>false</trackTrending>
        <type>Picklist</type>
    </fields>
    <listViews>
        <fullName>AllOpportunities</fullName>
        <filterScope>Everything</filterScope>
        <label>All Opportunities</label>
    </listViews>
    <listViews>
        <fullName>ClosingNextMonth</fullName>
        <filterScope>Everything</filterScope>
        <filters>
            <field>OPPORTUNITY.CLOSED</field>
            <operation>equals</operation>
            <value>0</value>
        </filters>
        <filters>
            <field>OPPORTUNITY.CLOSE_DATE</field>
            <operation>equals</operation>
            <value>NEXT_MONTH</value>
        </filters>
        <label>Closing Next Month</label>
    </listViews>
    <listViews>
        <fullName>ClosingThisMonth</fullName>
        <filterScope>Everything</filterScope>
        <filters>
            <field>OPPORTUNITY.CLOSED</field>
            <operation>equals</operation>
            <value>0</value>
        </filters>
        <filters>
            <field>OPPORTUNITY.CLOSE_DATE</field>
            <operation>equals</operation>
            <value>THIS_MONTH</value>
        </filters>
        <label>Closing This Month</label>
    </listViews>
    <listViews>
        <fullName>Default_Opportunity_Pipeline</fullName>
        <filterScope>Mine</filterScope>
        <filters>
            <field>OPPORTUNITY.CLOSE_DATE</field>
            <operation>greaterOrEqual</operation>
            <value>LAST_N_MONTHS:3</value>
        </filters>
        <label>Opportunity Pipeline</label>
    </listViews>
    <listViews>
        <fullName>MyOpportunities</fullName>
        <filterScope>Mine</filterScope>
        <label>My Opportunities</label>
    </listViews>
    <listViews>
        <fullName>NewLastWeek</fullName>
        <filterScope>Everything</filterScope>
        <filters>
            <field>OPPORTUNITY.CREATED_DATE</field>
            <operation>equals</operation>
            <value>LAST_WEEK</value>
        </filters>
        <label>New Last Week</label>
    </listViews>
    <listViews>
        <fullName>NewThisWeek</fullName>
        <filterScope>Everything</filterScope>
        <filters>
            <field>OPPORTUNITY.CREATED_DATE</field>
            <operation>equals</operation>
            <value>THIS_WEEK</value>
        </filters>
        <label>New This Week</label>
    </listViews>
    <listViews>
        <fullName>Private</fullName>
        <filterScope>Everything</filterScope>
        <filters>
            <field>OPPORTUNITY.PRIVATE</field>
            <operation>equals</operation>
            <value>1</value>
        </filters>
        <label>Private</label>
    </listViews>
    <listViews>
        <fullName>Won</fullName>
        <filterScope>Everything</filterScope>
        <filters>
            <field>OPPORTUNITY.CLOSED</field>
            <operation>equals</operation>
            <value>1</value>
        </filters>
        <filters>
            <field>OPPORTUNITY.WON</field>
            <operation>equals</operation>
            <value>1</value>
        </filters>
        <label>Won</label>
    </listViews>
    <searchLayouts>
        <customTabListAdditionalFields>OPPORTUNITY.NAME</customTabListAdditionalFields>
        <customTabListAdditionalFields>ACCOUNT.NAME</customTabListAdditionalFields>
        <customTabListAdditionalFields>OPPORTUNITY.CLOSE_DATE</customTabListAdditionalFields>
        <lookupDialogsAdditionalFields>OPPORTUNITY.NAME</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>ACCOUNT.NAME</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>ACCOUNT.SITE</lookupDialogsAdditionalFields>
        <lookupPhoneDialogsAdditionalFields>OPPORTUNITY.NAME</lookupPhoneDialogsAdditionalFields>
        <lookupPhoneDialogsAdditionalFields>ACCOUNT.NAME</lookupPhoneDialogsAdditionalFields>
        <lookupPhoneDialogsAdditionalFields>ACCOUNT.SITE</lookupPhoneDialogsAdditionalFields>
        <searchResultsAdditionalFields>OPPORTUNITY.NAME</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>ACCOUNT.NAME</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>ACCOUNT.SITE</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>OPPORTUNITY.STAGE_NAME</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>OPPORTUNITY.CLOSE_DATE</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>CORE.USERS.ALIAS</searchResultsAdditionalFields>
    </searchLayouts>
    <sharingModel>ReadWrite</sharingModel>
    <webLinks>
        <fullName>DeliveryStatus</fullName>
        <availability>online</availability>
        <displayType>link</displayType>
        <encodingKey>UTF-8</encodingKey>
        <hasMenubar>true</hasMenubar>
        <hasScrollbars>true</hasScrollbars>
        <hasToolbar>true</hasToolbar>
        <height>600</height>
        <isResizable>true</isResizable>
        <linkType>url</linkType>
        <masterLabel>Delivery Status</masterLabel>
        <openType>newWindow</openType>
        <position>none</position>
        <protected>false</protected>
        <showsLocation>true</showsLocation>
        <showsStatus>true</showsStatus>
        <url>http://www.fedex.com/cgi-bin/tracking?tracknumbers={!Opportunity_Tracking_Number}&amp;action=track&amp;language=english&amp;cntry_code=us</url>
    </webLinks>
    <webLinks>
        <fullName>MEAAttachement</fullName>
        <availability>online</availability>
        <description>manipulation des attachements</description>
        <displayType>button</displayType>
        <height>600</height>
        <linkType>page</linkType>
        <masterLabel>MEAAttachement</masterLabel>
        <openType>sidebar</openType>
        <page>MEAOppAttachment</page>
        <protected>false</protected>
    </webLinks>
    <webLinks>
        <fullName>MEA_ApexAjax</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <linkType>javascript</linkType>
        <masterLabel>MEA ApexAjax</masterLabel>
        <openType>onClickJavaScript</openType>
        <protected>false</protected>
        <url>{!REQUIRESCRIPT(&quot;/soap/ajax/31.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/31.0/apex.js&quot;)}   
{!REQUIRESCRIPT(&quot;/resource/1521653728000/jszip/jszip/dist/jszip.js&quot;)}
{!REQUIRESCRIPT(&quot;/resource/1521653728000/jszip/jszip/vendor/FileSaver.js&quot;)}
{!REQUIRESCRIPT(&quot;/resource/1521653728000/jsziputils/jsziputils/dist/jszip-utils.js&quot;)}
{!REQUIRESCRIPT(&quot;/resource/1521653728000/jszip/jszip/test/jquery-1.8.3.min.js&quot;)}

var sTemplateName = &quot;CONTRAT CADRE PBD 2018&quot;;

///////////////////////////////////// functions

function GetTemplate()
{
console.log(&apos;debut MMMM&apos;);
	//execute est synchrone dans le javascript
	var sBody = sforce.apex.execute(&quot;MEAGlobal&quot;,&quot;GetTemplate&quot;,{TemplateName:sTemplateName });
	return sBody

}

function updatefilefields(sTexte)
{
	sTexte = sTexte.replace(/\[\[([a-zA-Z\-\_\.\s]*)\]\]/g, function(wholematch,firstmatch)
  { 
console.log(&quot;firstmatch: &quot; + firstmatch);
return ochampsvalues[firstmatch];
});
return sTexte;
}


function parsefilefields(sTexte)
{
    var myreg = new RegExp(&quot;\\[\\[([a-zA-Z\-\_\.\s]*)\\]\\]&quot;,&quot;g&quot;);
    var matches = [];
    var tchamps = []; 
    var i=0;

	while(matches = myreg.exec(sTexte)) {  	   
           tchamps[i] = matches[1];
           console.log(&apos;matches: &apos; + matches[1]);
           //console.log(&apos;tchampsXX: &apos; + tchamps[i]);
           i++;
	}

//tchamps.pop();

for (var i in tchamps){
if (tchamps.hasOwnProperty(i)) { 
console.log(&apos;matchestchamps: &apos; + tchamps[i]);
}

}

     return tchamps;
}





function insertattachement(soptyID,bBody,sBody)
{
       sforce.apex.execute(&quot;MEAGlobal&quot;,&quot;insertattachement&quot;,{optyID:soptyID,bBody:bBody,sBody:sBody});
}



function getoppattlist() //test
{
	var tResult = sforce.apex.execute(&quot;MEAGlobal&quot;,&quot;getoppattlist&quot;,{optyID:soptyID});
	for (var i=0; i&lt;tResult.length; i++) {
		var id = tResult[i].Id;
		var ownerid = tResult[i].OwnerId;
		var ContentType = tResult[i].ContentType;                    
		console.log(&apos;\n id: &apos; + id + &apos;\n&apos; + &apos;ContentType: &apos; + ContentType);
	}
	console.log(tResult[0].Body);
}




function testMAPtoJSONtoObject ()
{
var sResult = sforce.apex.execute(&quot;MEAGlobal&quot;,&quot;getlist&quot;,{optyID:soptyID});
var obj1 = JSON.parse(sResult);
var nom = obj1[&apos;006w000000YxahhAAB&apos;].Name;
console.log(&apos;chaine: &apos; + sResult);
console.log(&apos;parse: &apos;+ obj1);
}



function getchampsvalues(tchamps)
{

for (var i in tchamps){
 console.log(&apos;insidefunc1 tchamps: &apos; + tchamps[i]);
}

//var tchamps2 = [&quot;Name&quot;,&quot;Type&quot;];

var sResult = sforce.apex.execute(&quot;MEAGlobal&quot;,&quot;getchampsvalues&quot;,{optyID:soptyID,listchamps:tchamps});
console.log(&apos;insidefunc sResult: &apos; + sResult);
var obj1 = JSON.parse(sResult);
console.log(&apos;insidefunc obj1: &apos; + obj1);

for (var i in tchamps){
   var champ = tchamps[i];
   var valeur = obj1[tchamps[i]];
   console.log(&apos;insidefunc boucle: &apos;+ valeur);
}

console.log(&apos;chaine: &apos; + sResult);
console.log(&apos;parse: &apos;+ obj1);
return obj1;
}


/////////////////////////////////////// main
var sBody=&quot;text&quot;
var soptyID = &apos;{!Opportunity.Id}&apos;;
var bBody = null;

var tBody = GetTemplate();
var sBody = tBody[0];
//console.log(sBody);
var tchamps = [];
var ochampsvalues = null;
var sBodyNew = &apos;AAA&apos;;        




var zip = new JSZip();
zip.loadAsync(sBody, {base64: true})
.then(function (zip) {
   console.log(zip.files);
zip.file(&quot;word/document.xml&quot;).async(&quot;string&quot;)
.then(function (data) {
   console.log(&quot;text1:\n&quot; +  data);
tchamps = parsefilefields(data);
   console.log(tchamps[0]);
ochampsvalues = getchampsvalues(tchamps);
   console.log(&apos;premier champ origine: &apos;+ ochampsvalues[tchamps[0]]);
   //console.log(&apos;valeurdeville2: &apos;+ ochampsvalues[&apos;VILLE&apos;]);
   console.log(&quot;ochampsvalues: &quot; + ochampsvalues);

data2 = updatefilefields(data);
   console.log(&quot;text2:\n&quot; +  data2);
zip.file(&quot;word/document.xml&quot;, data2);
zip.file(&quot;word/document.xml&quot;).async(&quot;string&quot;)
.then(function (data3) {
   console.log(&quot;data3&quot;);});
zip.generateAsync({type:&quot;base64&quot;})
				.then(function (content) {
					sBodyNew = content;
					//console.log(sBodyNew);
					insertattachement(soptyID,null,sBodyNew);
				}); //generateAsync
				// Download the new updated file
				//zip.generateAsync({type:&quot;blob&quot;}).then(function (content) {saveAs(content, &quot;mondoc.docx&quot;);});                
		  });
	});

console.log(&apos;FIN&apos;);</url>
    </webLinks>
</CustomObject>
